//
//  AspenHelperTests.m
//  Aspen
//
//  Created by Matt Drance on 9/30/15.
//  Copyright Â© 2015 Second Gear. All rights reserved.
//

@import XCTest;
@import Aspen;

@interface TestObjectPass : NSObject
@end
@implementation TestObjectPass
@end

@interface TestObjectFail : NSObject
@end
@implementation TestObjectFail
- (NSString *)description { @throw [NSException exceptionWithName:NSInvalidArgumentException reason:@"This object's -description method should never be called. If you see this message, a test has likely failed and a log statement has executed whose level dictates it should have been ignored." userInfo:nil]; }
@end


@interface AspenHelperTests : XCTestCase
@end

@implementation AspenHelperTests

- (void)setUp {
	[super setUp];
    
	[Aspen registerLogger:[[ConsoleLogger alloc] init]];
}

- (void)tearDown {
    [super tearDown];
}

// TODO: log / no-log confirmation
// This is less urgent since AspenTests are fairly thorough, but still nice to have
// Macro/helper-specific functionality is covered by -testDeferredVarargEvaluation

- (void)testDeferredVarargEvaluation {
	[Aspen setLoggingLevel:DefaultLogLevelError];

	// Verify that off-level Aspen varargs aren't even evaluated, avoiding any potential performance implications
	AspenVerbose(@"This should not print out: %@", [TestObjectFail new]);
	AspenInfo(@"This should not print out: %@", [TestObjectFail new]);
	AspenWarn(@"This should not print out: %@", [TestObjectFail new]);
	
	AspenError(@"This should print out: %@", [TestObjectPass new]);
}

- (void)testBuildWarnings {
	// nil format string
	AspenVerbose(nil);

	// too many varargs
	AspenVerbose(@"Foo %@", @(5), 5);

	// too few varargs
	AspenVerbose(@"Foo %@ %@", @(5));
}

@end
